{"version":3,"file":"Substitute.js","sourceRoot":"","sources":["../../src/Substitute.ts"],"names":[],"mappings":";;;AAAA,uCAAoC;AAGvB,QAAA,UAAU,GAAG,MAAM,EAAE,CAAC;AACtB,QAAA,qBAAqB,GAAG,MAAM,EAAE,CAAC;AAI9C,MAAa,UAAU;IACnB,MAAM,CAAC,GAAG;QACN,MAAM,aAAa,GAAG,IAAI,iBAAO,EAAE,CAAC;QACpC,OAAO,aAAa,CAAC,SAAS,CAAC;IACnC,CAAC;IAED,MAAM,CAAC,UAAU,CAAoD,UAAa;QAC9E,MAAM,SAAS,GAAG,UAAiB,CAAC,CAAC,YAAY;QACjD,MAAM,gBAAgB,GAAG,SAAS,CAAC,kBAAU,CAAC,CAAC,CAAC,UAAU;QAE1D,MAAM,YAAY,GAAG,CAAqB,CAAI,EAAK,EAAE;YACjD,OAAO;gBACH,SAAS,CAAC,6BAAqB,CAAC,GAAG,IAAI,CAAC;gBACxC,MAAM,WAAW,GAAG,CAAC,CAAC,IAAI,CAAC,gBAAgB,EAAE,GAAG,SAAS,CAAC,CAAC;gBAC3D,SAAS,CAAC,6BAAqB,CAAC,GAAG,KAAK,CAAC;gBACzC,OAAO,WAAW,CAAC;YACvB,CAAQ,CAAC;QACb,CAAC,CAAC;QAEF,OAAO,IAAI,KAAK,CAAC,GAAG,EAAE,GAAG,CAAC,EAAE;YACxB,KAAK,EAAE,UAAU,OAAO,EAAE,KAAK,EAAE,IAAI;gBACjC,OAAO,YAAY,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC,GAAG,SAAS,CAAC,CAAA;YACrE,CAAC;YACD,GAAG,EAAE,UAAU,OAAO,EAAE,QAAQ,EAAE,KAAK;gBACnC,OAAO,YAAY,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,GAAG,SAAS,CAAC,CAAA;YACnE,CAAC;YACD,GAAG,EAAE,UAAU,OAAO,EAAE,QAAQ;gBAC5B,gBAAgB,CAAC,aAAa,CAAC,SAAS,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAA;gBACpE,OAAO,YAAY,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC,GAAG,SAAS,CAAC,CAAA;YACnE,CAAC;SACJ,CAAQ,CAAC;IACd,CAAC;CACJ;AAhCD,gCAgCC","sourcesContent":["import { Context } from './Context';\r\nimport { ObjectSubstitute, OmitProxyMethods, DisabledSubstituteObject } from './Transformations';\r\n\r\nexport const HandlerKey = Symbol();\r\nexport const AreProxiesDisabledKey = Symbol();\r\n\r\nexport type SubstituteOf<T extends Object> = ObjectSubstitute<OmitProxyMethods<T>, T> & T;\r\n\r\nexport class Substitute {\r\n    static for<T>(): SubstituteOf<T> {\r\n        const objectContext = new Context();\r\n        return objectContext.rootProxy;\r\n    }\r\n\r\n    static disableFor<T extends ObjectSubstitute<OmitProxyMethods<any>>>(substitute: T): DisabledSubstituteObject<T> {\r\n        const thisProxy = substitute as any; // rootProxy\r\n        const thisExposedProxy = thisProxy[HandlerKey]; // Context\r\n\r\n        const disableProxy = <K extends Function>(f: K): K => {\r\n            return function () {\r\n                thisProxy[AreProxiesDisabledKey] = true;\r\n                const returnValue = f.call(thisExposedProxy, ...arguments);\r\n                thisProxy[AreProxiesDisabledKey] = false;\r\n                return returnValue;\r\n            } as any;\r\n        };\r\n\r\n        return new Proxy(() => { }, {\r\n            apply: function (_target, _this, args) {\r\n                return disableProxy(thisExposedProxy.getStateApply)(...arguments)\r\n            },\r\n            set: function (_target, property, value) {\r\n                return disableProxy(thisExposedProxy.setStateSet)(...arguments)\r\n            },\r\n            get: function (_target, property) {\r\n                thisExposedProxy._initialState.handleGet(thisExposedProxy, property)\r\n                return disableProxy(thisExposedProxy.getStateGet)(...arguments)\r\n            }\r\n        }) as any;\r\n    }\r\n}"]}